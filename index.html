<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CPU Stress Test - 24 Threads</title>
  <style>
    #output {
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
<h2>Running 24 CPU-intensive Web Workers...</h2>
<div id="output"></div>

<script>
  const output = document.getElementById('output');
  const workerCount = 24;

  // Worker 脚本内容
  const workerScript = `
    function complexArrayCalculation(size) {
      let arr = new Array(size).fill(0).map((_, i) => Math.random() * i);
      for (let j = 0; j < 100; j++) {
        arr = arr.map(x => Math.sin(x) * Math.sqrt(x + 1));
      }
      return arr.slice(0, 5); // 返回前5个值用于展示
    }

    while (true) {
      const result = complexArrayCalculation(10000);
      postMessage(result);
      // 控制频率，防止输出过快卡死
      setTimeout(() => {}, 10);
    }
  `;

  const blob = new Blob([workerScript], { type: 'application/javascript' });
  const url = URL.createObjectURL(blob);

  for (let i = 0; i < workerCount; i++) {
    const worker = new Worker(url);
    worker.onmessage = function (e) {
      const result = e.data.join(', ');
      output.innerHTML += `<div>[Worker ${i + 1}] Output: ${result}</div>`;
    };
    worker.onerror = function (e) {
      console.error(`Worker ${i + 1} error:`, e.message);
    };
  }
</script>
</body>
</html>
